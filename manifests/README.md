# How to generate 'checkm' manifest files (on Linux)

## Introduction

We propose that the datasets (sources) brought to JASMIN are managed using 
a structure along the lines of:

 `...group_workspace.../data/incoming/raw/<source_name>/<version>/`

The `<source_name>` will be a short identifier that the project is using in
file names and metadata to describe the source (a.k.a. dataset). 

The `<version>` is a date identifier (formatted as `vYYYYDDMM`) to identify
a specific version (i.e. collection of files) for that given source.

Under the `<version>` directory we will include:

```
.../manifest.txt
    inventory.txt
    data/
```

The `manifest.txt` file will list the contents of the specific version in 
terms of the file paths, file sizes and MD5 checksums. These files will 
be generated using the `checkm` tool (http://pythonhosted.org/Checkm/).

## Setting up your environment to use 'checkm'

Suppose you had some files under a directory:

```
/tmp/mydata/
           initial/001.dat
           initial/002.dat
           final/v1/combined.dat
           final/v2/combined.dat
```

You want to create a manifest file for everything under `.../mydata/`.

You can do this with the following commands:

 1. Go to a directory to work under:

```
mkdir -p example
cd example
```

 2. Set up a python virtual environment and activate it:

```
virtualenv venv
source venv/bin/activate
```

 3. Install the checkm library:

```
pip install checkm
```

 4. Run the checkm script pointing at the directory you wish to scan:

```
checkm write -r manifest.txt mydata
```

## What does a checkm manifest file look like?

Here is the manifest file generated by the code above:

```
# [@]SourceFileOrURL             | Alg     | Digest                               | Length   | ModTime
mydata/initial                   | md5     | d                                    | 4096     | 1495206406
mydata/final                     | md5     | d                                    | 4096     | 1495206387
mydata/initial/002.dat           | md5     | 615c39d58f43f81301c4dd242845409e     | 6        | 1495206406
mydata/initial/001.dat           | md5     | dac9522e957b744ad22063bf683c6a32     | 6        | 1495206398
mydata/final/v2                  | md5     | d                                    | 4096     | 1495206432
mydata/final/v1                  | md5     | d                                    | 4096     | 1495206425
mydata/final/v2/combined.dat     | md5     | 210f6dee8ef84efc57be4a343bdd3bd8     | 12       | 1495206432
mydata/final/v1/combined.dat     | md5     | 0a1f2d66a7384a356ed11aa59db8960f     | 11       | 1495206425
```

## What about re-running for other directories?

Always remember that you have to run `source venv/bin/activate` 
(from the correct working directory) in order to have the `checkm`
command available in your terminal session.
